<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Sheetsé€£æº è‹±å˜èªã‚¯ã‚¤ã‚º</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid #667eea;
        }
        
        .header h1 {
            color: #333;
            margin: 0;
            font-size: 2.5em;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .setup-section {
            margin-bottom: 30px;
            padding: 25px;
            background: #f8f9ff;
            border-radius: 10px;
            border-left: 5px solid #667eea;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }
        
        .input-group input, .input-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }
        
        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .settings-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-secondary {
            background: linear-gradient(45deg, #10b981, #059669);
            box-shadow: 0 5px 15px rgba(16, 185, 129, 0.4);
        }
        
        .btn-secondary:hover {
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.6);
        }
        
        .status {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: bold;
            text-align: center;
        }
        
        .status.loading {
            background: #fef3c7;
            color: #92400e;
            border: 2px solid #fbbf24;
        }
        
        .status.success {
            background: #d1fae5;
            color: #065f46;
            border: 2px solid #10b981;
        }
        
        .status.error {
            background: #fee2e2;
            color: #991b1b;
            border: 2px solid #ef4444;
        }
        
        .quiz-section {
            display: none;
        }
        
        .quiz-section.active {
            display: block;
        }
        
        .question-container {
            margin-bottom: 30px;
            padding: 25px;
            border-left: 5px solid #667eea;
            background: #f8f9ff;
            border-radius: 10px;
            transition: transform 0.3s ease;
        }
        
        .question-container:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .question-number {
            font-weight: bold;
            color: #667eea;
            font-size: 1.2em;
            margin-bottom: 10px;
        }
        
        .sentence {
            font-size: 1.1em;
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 2px solid #e0e7ff;
        }
        
        .blank {
            background: #fef3c7;
            padding: 2px 8px;
            border-radius: 4px;
            font-weight: bold;
            color: #92400e;
        }
        
        .info-section {
            display: flex;
            gap: 30px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .meaning, .pronunciation {
            background: #667eea;
            color: white;
            padding: 10px 15px;
            border-radius: 25px;
            font-weight: bold;
            flex: 1;
            min-width: 200px;
            text-align: center;
        }
        
        .pronunciation {
            background: #764ba2;
        }
        
        .choices {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }
        
        .choice {
            padding: 15px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
            font-weight: 500;
            text-align: center;
        }
        
        .choice:hover {
            border-color: #667eea;
            background: #f0f4ff;
            transform: translateY(-1px);
        }
        
        .choice.selected {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }
        
        .choice.correct {
            border-color: #10b981;
            background: #10b981;
            color: white;
        }
        
        .choice.incorrect {
            border-color: #ef4444;
            background: #ef4444;
            color: white;
        }
        
        .result {
            text-align: center;
            font-size: 1.3em;
            font-weight: bold;
            margin-top: 30px;
            padding: 20px;
            border-radius: 10px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }
        
        .explanation {
            margin-top: 15px;
            padding: 15px;
            background: #e0f2fe;
            border-radius: 8px;
            border-left: 4px solid #0891b2;
            display: none;
        }
        
        .explanation.show {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        .instructions {
            background: #e0f2fe;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 5px solid #0891b2;
        }
        
        .instructions h3 {
            margin-top: 0;
            color: #0c4a6e;
        }
        
        .instructions ol {
            margin: 0;
            padding-left: 20px;
        }
        
        .instructions li {
            margin-bottom: 8px;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @media (max-width: 600px) {
            .choices {
                grid-template-columns: 1fr;
            }
            
            .info-section {
                flex-direction: column;
                gap: 10px;
            }
            
            .meaning, .pronunciation {
                min-width: auto;
            }
            
            .settings-grid {
                grid-template-columns: 1fr;
            }

		body {
    		padding: 10px;
		}

		.sentence {
		    font-size: 1em;
    		padding: 10px;
		}

		.choice {
    		font-size: 0.95em;
    		padding: 10px;
		}

		.result {
    		font-size: 1.1em;
    		padding: 15px;
		}

        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“Š Google Sheetsé€£æºã‚¯ã‚¤ã‚º</h1>
            <p>ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‹ã‚‰è‡ªå‹•ã§å•é¡Œã‚’ç”Ÿæˆã—ã¾ã™</p>
        </div>
        
        <div class="instructions">
            <h3>ğŸ”§ è¨­å®šæ‰‹é †</h3>
            <ol>
                <li>Google Sheetsã§ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’ä½œæˆã—ã€Aåˆ—:è‹±å˜èªã€Båˆ—:å“è©ã€Cåˆ—:ç™ºéŸ³ã€Dåˆ—:æ—¥æœ¬èªè¨³ã€Eåˆ—:ä¾‹æ–‡ã‚’å…¥åŠ›</li>
                <li>ã€Œãƒ•ã‚¡ã‚¤ãƒ«ã€â†’ã€Œå…±æœ‰ã€â†’ã€Œã‚¦ã‚§ãƒ–ã«å…¬é–‹ã€ã‚’é¸æŠ</li>
		<li>ã€Œãƒªãƒ³ã‚¯ã€ã‚¿ãƒ–ã§ã€ŒCSVã€å½¢å¼ã‚’é¸æŠã—ã¦URLã‚’ã‚³ãƒ”ãƒ¼</li>
                <li>ä¸‹è¨˜ã«URLã‚’è²¼ã‚Šä»˜ã‘ã¦ã€Œãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã€ã‚’ã‚¯ãƒªãƒƒã‚¯</li>
                <li>å•é¡Œæ•°ã¨é›£æ˜“åº¦ã‚’è¨­å®šã—ã¦ã€Œã‚¯ã‚¤ã‚ºé–‹å§‹ã€ã‚’ã‚¯ãƒªãƒƒã‚¯</li>
            </ol>
        </div>
        
        <div class="setup-section">
            <div class="input-group">
                <label for="spreadsheetUrl">Google Sheets CSV URL:</label>
                <input type="url" id="spreadsheetUrl" placeholder="https://docs.google.com/spreadsheets/d/YOUR_SHEET_ID/export?format=csv&gid=0">
            </div>
            
            <div class="settings-grid">
                <div class="input-group">
                    <label for="questionCount">å•é¡Œæ•°:</label>
                    <select id="questionCount">
                        <option value="5">5å•</option>
                        <option value="10" selected>10å•</option>
                        <option value="15">15å•</option>
                        <option value="20">20å•</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label for="partOfSpeech">å“è©ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼:</label>
                    <select id="partOfSpeech">
                        <option value="all">å…¨ã¦</option>
                        <option value="noun">åè©</option>
                        <option value="verb">å‹•è©</option>
                        <option value="adj">å½¢å®¹è©</option>
                        <option value="adv">å‰¯è©</option>
                    </select>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn" onclick="loadSpreadsheetData()">ğŸ“¥ ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿</button>
                <button class="btn btn-secondary" onclick="startQuiz()" disabled id="startBtn">ğŸ¯ ã‚¯ã‚¤ã‚ºé–‹å§‹</button>
            </div>
        </div>
        
        <div id="status" class="status" style="display: none;"></div>
        
        <div id="quiz-section" class="quiz-section">
            <div id="quiz-container"></div>
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn" onclick="checkAnswers()" id="submitBtn">ğŸ“‹ ç­”ãˆåˆã‚ã›</button>
                <button class="btn btn-secondary" onclick="resetQuiz()" style="margin-left: 10px;">ğŸ”„ æ–°ã—ã„ã‚¯ã‚¤ã‚º</button>
            </div>
            <div id="result" class="result" style="display: none;"></div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script>
        let vocabularyData = [];
        let currentQuestions = [];
        let userAnswers = {};
        
        function showStatus(message, type) {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
            statusDiv.style.display = 'block';
        }
        
        function hideStatus() {
            document.getElementById('status').style.display = 'none';
        }
        
        async function loadSpreadsheetData() {
            const url = document.getElementById('spreadsheetUrl').value.trim();
            
            if (!url) {
                showStatus('URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
                return;
            }
            
            // URLã®å½¢å¼ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ä¿®æ­£ææ¡ˆ
            if (url.includes('pubhtml')) {
                showStatus('URLã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚ã€Œpubhtmlä»¥é™ã€ã‚’ã€Œpub?output=csvã€ã«å¤‰æ›´ã—ã¦ãã ã•ã„', 'error');
                return;
            }
            
            showStatus('ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...', 'loading');
            
            try {
                // CORSãƒ—ãƒ­ã‚­ã‚·ã‚’ä½¿ç”¨ã—ã¦Google Sheetsã®CSVã«ã‚¢ã‚¯ã‚»ã‚¹
                const corsProxies = [
                    'https://cors-anywhere.herokuapp.com/',
                    'https://api.allorigins.win/raw?url=',
                    'https://corsproxy.io/?'
                ];
                
                let response;
                let csvText;
                
                // ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ã‚’è©¦è¡Œ
                try {
                    response = await fetch(url);
                    if (response.ok) {
                        csvText = await response.text();
                    } else {
                        throw new Error('Direct access failed');
                    }
                } catch (directError) {
                    console.log('Direct access failed, trying CORS proxy...');
                    
                    // CORSãƒ—ãƒ­ã‚­ã‚·ã‚’ä½¿ç”¨
                    let proxySuccess = false;
                    for (const proxy of corsProxies) {
                        try {
                            const proxyUrl = proxy + encodeURIComponent(url);
                            response = await fetch(proxyUrl);
                            if (response.ok) {
                                csvText = await response.text();
                                proxySuccess = true;
                                break;
                            }
                        } catch (proxyError) {
                            console.log(`Proxy ${proxy} failed:`, proxyError);
                        }
                    }
                    
                    if (!proxySuccess) {
                        throw new Error('CORSã‚¨ãƒ©ãƒ¼: ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¾ã—ãŸã€‚ã‚·ãƒ¼ãƒˆã®å…±æœ‰è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
                    }
                }
                
                // HTMLãŒè¿”ã•ã‚ŒãŸå ´åˆã®æ¤œå‡º
                if (csvText.trim().startsWith('<!DOCTYPE') || csvText.trim().startsWith('<html')) {
                    throw new Error('CSVã§ã¯ãªãHTMLãŒè¿”ã•ã‚Œã¾ã—ãŸã€‚URLã®å½¢å¼ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼ˆpub?output=csv ã‚’ä½¿ç”¨ï¼‰');
                }
                
                Papa.parse(csvText, {
                    header: true,
                    skipEmptyLines: true,
                    dynamicTyping: false,
                    complete: function(results) {
                        console.log('Parse results:', results);
                        
                        if (results.errors.length > 0) {
                            showStatus('CSVã®è§£æä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + results.errors[0].message, 'error');
                            console.error('Parse errors:', results.errors);
                            return;
                        }
                        
                        if (!results.data || results.data.length === 0) {
                            showStatus('ãƒ‡ãƒ¼ã‚¿ãŒç©ºã§ã™', 'error');
                            return;
                        }
                        
                        // ãƒ˜ãƒƒãƒ€ãƒ¼ã®ç¢ºèª
                        const firstRow = results.data[0];
                        console.log('First row headers:', Object.keys(firstRow));
                        
                        // æŸ”è»Ÿãªãƒ˜ãƒƒãƒ€ãƒ¼ãƒãƒƒãƒ”ãƒ³ã‚°
                        vocabularyData = results.data.map(row => {
                            const keys = Object.keys(row);
                            return {
                                word: (row['English Word'] || row[keys[0]] || '').toString().trim(),
                                pos: (row['Part of Speech'] || row[keys[1]] || '').toString().trim(),
                                pronunciation: (row['Pronunciation'] || row[keys[2]] || '').toString().trim(),
                                meaning: (row['Meaning (Japanese)'] || row[keys[3]] || '').toString().trim(),
                                example: (row['Example Sentence (English)'] || row[keys[4]] || '').toString().trim()
                            };
                        }).filter(item => item.word && item.meaning && item.example);
                        
                        if (vocabularyData.length === 0) {
                            showStatus('æœ‰åŠ¹ãªãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚åˆ—ã®å½¢å¼ã‚’ç¢ºèªã—ã¦ãã ã•ã„', 'error');
                            console.log('Sample data:', results.data.slice(0, 3));
                            return;
                        }
                        
                        showStatus(`${vocabularyData.length}ä»¶ã®ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ`, 'success');
                        document.getElementById('startBtn').disabled = false;
                    }
                });
                
            } catch (error) {
                showStatus('ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message, 'error');
                console.error('Error loading data:', error);
            }
        }
        
        function getWordVariations(word, pos) {
            const variations = [word];
            
            if (pos.includes('V')) {
                // å‹•è©ã®æ´»ç”¨å½¢ã‚’ç”Ÿæˆ
                if (word.endsWith('e')) {
                    variations.push(word + 'd', word + 's', word.slice(0, -1) + 'ing');
                } else if (word.endsWith('y') && !['a', 'e', 'i', 'o', 'u'].includes(word[word.length - 2])) {
                    variations.push(word.slice(0, -1) + 'ied', word.slice(0, -1) + 'ies', word + 'ing');
                } else if (word.match(/[bcdfghjklmnpqrstvwxyz]$/)) {
                    const lastChar = word[word.length - 1];
                    if (['p', 'g', 't', 'd', 'm', 'n'].includes(lastChar)) {
                        variations.push(word + lastChar + 'ed', word + 's', word + lastChar + 'ing');
                    } else {
                        variations.push(word + 'ed', word + 's', word + 'ing');
                    }
                } else {
                    variations.push(word + 'ed', word + 's', word + 'ing');
                }
            }
            
            return variations;
        }
        
        function findWordInSentence(sentence, word, pos) {
            const variations = getWordVariations(word, pos);
            const words = sentence.toLowerCase().split(/\W+/);
            
            for (const variation of variations) {
                if (words.includes(variation.toLowerCase())) {
                    return variation;
                }
            }
            
            return word;
        }
        
        function createSentenceWithBlank(sentence, word, pos) {
            const actualWord = findWordInSentence(sentence, word, pos);
            const regex = new RegExp(`\\b${actualWord}\\b`, 'gi');
            return {
                sentence: sentence.replace(regex, '_______'),
                correctAnswer: actualWord
            };
        }
        
        function filterByPartOfSpeech(data, filter) {
            if (filter === 'all') return data;
            
            const posMap = {
                'noun': ['N(C)', 'N(U)', 'N(the + pl.)', 'N(C/U)'],
                'verb': ['V(vt)', 'V(vi)', 'V(vi/vt)', 'V(vt/vi)'],
                'adj': ['Adj'],
                'adv': ['Adv']
            };
            
            return data.filter(item => {
                const itemPos = item.pos.split('/');
                return itemPos.some(pos => 
                    posMap[filter] && posMap[filter].some(p => pos.includes(p))
                );
            });
        }
        
        function generateChoices(correctAnswer, allData, pos, count = 4) {
            const choices = [correctAnswer];
            const samePosWords = allData.filter(item => 
                item.pos === pos && item.word !== correctAnswer.split(/\s+/)[0]
            );
            
            while (choices.length < count && samePosWords.length > 0) {
                const randomIndex = Math.floor(Math.random() * samePosWords.length);
                const randomWord = samePosWords[randomIndex].word;
                
                if (!choices.includes(randomWord)) {
                    choices.push(randomWord);
                }
                samePosWords.splice(randomIndex, 1);
            }
            
            // ã‚·ãƒ£ãƒƒãƒ•ãƒ«
            for (let i = choices.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [choices[i], choices[j]] = [choices[j], choices[i]];
            }
            
            return choices;
        }
        
        function startQuiz() {
            const questionCount = parseInt(document.getElementById('questionCount').value);
            const posFilter = document.getElementById('partOfSpeech').value;
            
            const filteredData = filterByPartOfSpeech(vocabularyData, posFilter);
            
            if (filteredData.length < questionCount) {
                showStatus(`é¸æŠã—ãŸæ¡ä»¶ã§ã¯${filteredData.length}å•ã—ã‹ä½œæˆã§ãã¾ã›ã‚“`, 'error');
                return;
            }
            
            // ãƒ©ãƒ³ãƒ€ãƒ ã«å•é¡Œã‚’é¸æŠ
            const shuffled = [...filteredData].sort(() => Math.random() - 0.5);
            const selectedData = shuffled.slice(0, questionCount);
            
            currentQuestions = selectedData.map((item, index) => {
                const { sentence, correctAnswer } = createSentenceWithBlank(item.example, item.word, item.pos);
                const choices = generateChoices(correctAnswer, vocabularyData, item.pos);
                
                return {
                    id: index + 1,
                    sentence: sentence,
                    meaning: item.meaning,
                    pronunciation: item.pronunciation,
                    choices: choices,
                    correctAnswer: correctAnswer,
                    originalWord: item.word
                };
            });
            
            renderQuiz();
            document.getElementById('quiz-section').classList.add('active');
            hideStatus();
            userAnswers = {};
        }
        
        function renderQuiz() {
            const container = document.getElementById('quiz-container');
            container.innerHTML = '';
            
            currentQuestions.forEach(question => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question-container';
                questionDiv.innerHTML = `
                    <div class="question-number">Question ${question.id}</div>
                    <div class="sentence">${question.sentence}</div>
                    <div class="info-section">
                        <div class="meaning">${question.meaning}</div>
                        <div class="pronunciation">${question.pronunciation}</div>
                    </div>
                    <div class="choices">
                        ${question.choices.map(choice => 
                            `<div class="choice" data-question="${question.id}" data-answer="${choice}" onclick="selectChoice(${question.id}, '${choice}')">${choice}</div>`
                        ).join('')}
                    </div>
                    <div class="explanation" id="explanation-${question.id}">
                        <strong>æ­£è§£:</strong> ${question.correctAnswer}<br>
                        <strong>åŸå½¢:</strong> ${question.originalWord}<br>
                        <strong>æ„å‘³:</strong> ${question.meaning}
                    </div>
                `;
                container.appendChild(questionDiv);
            });
        }
        
        function selectChoice(questionId, answer) {
            userAnswers[questionId] = answer;
            
            // é¸æŠçŠ¶æ…‹ã‚’æ›´æ–°
            const choices = document.querySelectorAll(`[data-question="${questionId}"]`);
            choices.forEach(choice => {
                choice.classList.remove('selected');
                if (choice.dataset.answer === answer) {
                    choice.classList.add('selected');
                }
            });
        }
        
        function checkAnswers() {
            let correct = 0;
            
            currentQuestions.forEach(question => {
                const userAnswer = userAnswers[question.id];
                const isCorrect = userAnswer === question.correctAnswer;
                
                if (isCorrect) correct++;
                
                // çµæœã‚’è¡¨ç¤º
                const choices = document.querySelectorAll(`[data-question="${question.id}"]`);
                choices.forEach(choice => {
                    const answer = choice.dataset.answer;
                    choice.classList.remove('selected');
                    
                    if (answer === question.correctAnswer) {
                        choice.classList.add('correct');
                    } else if (answer === userAnswer && !isCorrect) {
                        choice.classList.add('incorrect');
                    }
                });
                
                // è§£èª¬ã‚’è¡¨ç¤º
                document.getElementById(`explanation-${question.id}`).classList.add('show');
            });
            
            // çµæœã‚’è¡¨ç¤º
            const percentage = Math.round((correct / currentQuestions.length) * 100);
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = `
                ğŸ¯ çµæœ: ${correct}/${currentQuestions.length}å•æ­£è§£ (${percentage}%)
                <br>
                ${percentage >= 80 ? 'ğŸ‰ å„ªç§€ã§ã™ï¼' : percentage >= 60 ? 'ğŸ‘ è‰¯ã„çµæœã§ã™ï¼' : 'ğŸ“š ã‚‚ã†å°‘ã—é ‘å¼µã‚Šã¾ã—ã‚‡ã†ï¼'}
            `;
            resultDiv.style.display = 'block';
            
            document.getElementById('submitBtn').disabled = true;
        }
        
        function resetQuiz() {
            document.getElementById('quiz-section').classList.remove('active');
            document.getElementById('result').style.display = 'none';
            document.getElementById('submitBtn').disabled = false;
            userAnswers = {};
            currentQuestions = [];
        }
    </script>
</body>
</html>
